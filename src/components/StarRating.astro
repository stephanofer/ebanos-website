---
interface Props {
  rating: number;
  maxRating?: number;
  size?: "sm" | "md" | "lg";
  showValue?: boolean;
}

const { rating, maxRating = 5, size = "sm", showValue = false } = Astro.props;

// Calcular estrellas llenas, medias y vacías
const fullStars = Math.floor(rating);
const hasHalfStar = rating % 1 >= 0.5;
const emptyStars = maxRating - fullStars - (hasHalfStar ? 1 : 0);

const sizeClasses = {
  sm: "star-sm",
  md: "star-md", 
  lg: "star-lg"
};
---

<div class={`star-rating ${sizeClasses[size]}`} role="img" aria-label={`Puntuación: ${rating} de ${maxRating} estrellas`}>
  <div class="stars">
    {/* Estrellas llenas */}
    {Array(fullStars).fill(0).map(() => (
      <svg class="star star-full" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    ))}
    
    {/* Estrella media */}
    {hasHalfStar && (
      <svg class="star star-half" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="halfGradient">
            <stop offset="50%" stop-color="currentColor"/>
            <stop offset="50%" stop-color="#e0e0e0"/>
          </linearGradient>
        </defs>
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="url(#halfGradient)"/>
      </svg>
    )}
    
    {/* Estrellas vacías */}
    {Array(emptyStars).fill(0).map(() => (
      <svg class="star star-empty" viewBox="0 0 24 24" fill="#e0e0e0" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    ))}
  </div>
  
  {showValue && (
    <span class="rating-value">{rating.toFixed(1)}</span>
  )}
</div>

<style>
  .star-rating {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
  }

  .stars {
    display: flex;
    align-items: center;
    gap: 0.1rem;
  }

  .star {
    color: #f59e0b; /* Amber/gold - color óptimo para estrellas según UX */
  }

  .star-full {
    color: #f59e0b;
  }

  .star-empty {
    color: #e0e0e0;
  }

  /* Tamaños */
  .star-sm .star {
    width: 14px;
    height: 14px;
  }

  .star-md .star {
    width: 18px;
    height: 18px;
  }

  .star-lg .star {
    width: 24px;
    height: 24px;
  }

  .rating-value {
    font-family: "Inter", sans-serif;
    font-weight: 600;
    color: var(--foreground);
  }

  .star-sm .rating-value {
    font-size: 0.75rem;
  }

  .star-md .rating-value {
    font-size: 0.875rem;
  }

  .star-lg .rating-value {
    font-size: 1rem;
  }
</style>
